---
output: 
  pdf_document:
    includes:
      in_header: "Report.preamble.tex"
params: 
    surveyTable: NULL
    surveyTablePrepped: NULL
    nvcAverageSim: NULL
    assignNVCResults: NULL
    sidebar_options: NULL
    dcaFixedSpaceResults: NULL
bibliography: Report.refs.bib
link-citations: yes
editor_options: 
  markdown: 
    wrap: 72
title: \textbf{\textcolor{ceh.dark.blue}{MAVIS}}
subtitle: \textbf{\textcolor{ceh.dark.blue}{User Report}}
# author: "Author"
date: \textbf{\textcolor{ceh.dark.blue}{`r Sys.Date()`}}
---

```{r load_packages, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(kableExtra)
```

```{r retrieve_data, message=FALSE, warning=FALSE, include=FALSE}

# source("../create_constants.R", local = knitr::knit_global())
# sys.source("./create_constants.R", envir = knitr::knit_global())

surveyTable <- params$surveyTable
surveyTablePrepped <- params$surveyTablePrepped
nvcAverageSim <- params$nvcAverageSim
assignNVCResults <- params$assignNVCResults
sidebar_options <- params$sidebar_options
dcaFixedSpaceResults <- params$dcaFixedSpaceResults
selected_pquads_dca_results_species_final <- dcaFixedSpaceResults$selected_pquads_dca_results_species
selected_pquads_dca_results_quadrats_final <- dcaFixedSpaceResults$selected_pquads_dca_results_quadrats_final
surveyTable_dca_results_quadrats <- dcaFixedSpaceResults$surveyTable_dca_results_quadrats
selected_pquads_dca_results_quadrats_final_hull <- dcaFixedSpaceResults$selected_pquads_dca_results_quadrats_final_hull

```

# Introduction
The Modular Analysis of Vegetation Information System (MAVIS) is a tool..

# Input Data Parameters



\newpage
# Results

## Jaccard Similarity - Pseudo-quadrat Method

```{r nvcAverageSimTable, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}

nvcAverageSimTable <- nvcAverageSim

kableExtra::kbl(x = nvcAverageSimTable, format = "latex", booktabs = TRUE,
                longtable = TRUE, linesep = "",
                caption = "The top N NVC communities fitted using the pseudo-quadrat method.") |>
  kableExtra::kable_styling(latex_options = c("repeat_header", "HOLD_position"))

```

\newpage
## Habitat Correspondences

\newpage
## Composed Floristic Tables

\newpage
## Detrended Correspondence Analysis

```{r dca, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}

method1DCAPlot_plot <- ggplot2::ggplot() +
  ggplot2::geom_polygon(data = selected_pquads_dca_results_quadrats_final_hull, alpha = 0.2,
                        mapping = ggplot2::aes(x = DCA1, 
                                               y = DCA2, 
                                               fill = NVC.Comm
                                               )) +
  # ggplot2::geom_point(data = selected_pquads_dca_results_quadrats_final,
  #                     mapping = ggplot2::aes(color = NVC.Comm, 
  #                                            Quadrat = Quadrat, 
  #                                            x = DCA1,
  #                                            y = DCA2)) +
  ggplot2::geom_point(data = surveyTable_dca_results_quadrats,
                      mapping = ggplot2::aes(Year = Year,
                                             Group = Group,
                                             Quadrat = Quadrat,
                                             x = DCA1,
                                             y = DCA2)) +
  # ggplot2::geom_point(data = selected_pquads_dca_results_species_final,
  #                     mapping = ggplot2::aes(x = DCA1, 
  #                                            y = DCA2,
  #                                            Species = Species)) +
  ggplot2::geom_path(data = surveyTable_dca_results_quadrats_final,
                     mapping = ggplot2::aes(x = DCA1,
                                            y = DCA2),
                     arrow = grid::arrow()) +
  ggplot2::theme_minimal()

method1DCAPlot_plot

```


\newpage
# Appendix

## Samples

```{r samplesTable, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}

samplesTable <- surveyTablePrepped |>
  dplyr::select(ID) |>
  dplyr::distinct()

kableExtra::kbl(x = samplesTable, format = "latex", booktabs = TRUE,
                longtable = TRUE, linesep = "",
                caption = "Samples assessed in the analysis.") |>
  kableExtra::kable_styling(latex_options = c("repeat_header", "HOLD_position"))

```

## Survey Data Table

```{r surveyTable, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}

kableExtra::kbl(x = surveyTable, format = "latex", booktabs = TRUE,
                longtable = TRUE, linesep = "",
                caption = "Survey Data Table") |>
  kableExtra::kable_styling(latex_options = c("repeat_header", "HOLD_position"))

```

